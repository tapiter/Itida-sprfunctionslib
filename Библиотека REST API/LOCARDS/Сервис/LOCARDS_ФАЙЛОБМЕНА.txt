//определим расположение файла обмена
ПутьКФайлу = "";

IF (ПУСТО(ПОЛНЫЙПУТЬКФАЙЛУ))
{
	ПутьКФайлу = ПОКРУЖЕНИЯ("appdata");
	
	//на всякий случай проверим существование каталога
	IF ( !ФАЙЛ(ПутьКФайлу, 1) )
	{
		//если нет каталога в системе, то будем далее пытаться писать во временный каталог
		ПутьКФайлу = ВРЕМЕННЫЙКАТАЛОГ();
	}
	ELSE
	{
		//если каталог есть в системе, то проверим наличие вложенного каталога Itida
		IF ( !ФАЙЛ(ПутьКФайлу + "\Itida", 1) )
		{
			//если нет каталога Itida, то создадим его
			IF ( КАТАЛОГСОЗДАТЬ(ПутьКФайлу + "\Itida") )
			{
				//если каталог создался, то меняем полный путь с учетом созданного каталога
				ПутьКФайлу = ПутьКФайлу + "\Itida";
			}
		}
		ELSE
		{
			ПутьКФайлу = ПутьКФайлу + "\Itida";
		}
	}
	IF (_ОПЕРАЦИЯОБМЕНА  == "ВЫГРУЗКАJSON")
		ИмяФайлаДляСервера = "locards_cards_"+ALLTRIM(КОДОБОРУДОВАНИЯ)+".txt";
	ELSE IF (_ОПЕРАЦИЯОБМЕНА  == "ВЫГРУЗКАCSV")
		ИмяФайлаОбмена = "locards_cards_"+ALLTRIM(КОДОБОРУДОВАНИЯ)+".csv";
	ELSE IF (_ОПЕРАЦИЯОБМЕНА  == "ЗАГРУЗКА")	
		ИмяФайлаОбмена = "locards_cards_in_"+ALLTRIM(КОДОБОРУДОВАНИЯ)+".txt";
	ELSE
		ИмяФайлаОбмена = "locards_"+ALLTRIM(КОДОБОРУДОВАНИЯ)+".txt";
		
	ИмяФайлаПОЛНОЕ = ПутьКФайлу+ИмяФайлаОбмена;
}
ELSE
{
	ИмяФайлаПОЛНОЕ = ПОЛНЫЙПУТЬКФАЙЛУ;	
}

//создадим временные файлы обмена
ДескрипторФайла			= -1;

// Если файл уже существовал, то закрываем его
IF  ( ДескрипторФайла != -1 ) ФайлЗакрыть( ДескрипторФайла );
// Создаем новый файл

ДескрипторФайла		= ФайлСоздать( ИмяФайлаПОЛНОЕ );
IF ( ДескрипторФайла == -1 )
{
	_КОДОШИБКИ		= "001";
	_ТЕКСТОШИБКИ	= "Не удалось создать временный файл обмена '" + ALLTRIM( ИмяФайлаПОЛНОЕ ) + "'.";
	_ОШИБКАВЫПОЛНЕНИЯ	= true;
	RETURN false;
}
ФайлЗакрыть( ДескрипторФайла )

RETURN ИмяФайлаПОЛНОЕ;
