
//---- Достаем скрипт из базы данных
_ТОЧКАЗРЕНИЯ							= ЗАПРОС( "SELECT dbo.fn_getdefaultviewpoint( )" );
ТекстСкрипта							= ЗАПРОС( "SELECT valid_ex FROM specviewpoints_obj WHERE code= '" + _ТОЧКАЗРЕНИЯ + "' AND objtype = 'DOC' AND objcode = '" + _DOCCODE + "'" );

//---- Если текст не определен - выходим
IF ( ПУСТО( ТекстСкрипта ) ) RETURN true;
IF ( !ПУСТО( ПАРАМЕТРЫ ) ) ВЫЧИСЛИТЬ( ПАРАМЕТРЫ );

//------ Могли передать УИД документа
IF ( ТИП( "_DOCIC" ) == "C" )
	_DOCIC								= ЗАПРОС( "SELECT ic FROM spr000 WHERE CONVERT( varchar( 50 ), rid ) = '" + STDF( _DOCIC ) + "'" );

//------ Перед загрузкой установим значения переменных для вычислителя
ДОБАВИТЬКОНТЕКСТ( "SELECT TOP 1 * FROM spec" + _DOCCODE + " WHERE ic = " + _DOCIC, "ВременныйДокумент" );
ЧИТАТЬЗАПИСЬ( "ВременныйДокумент" );
УДАЛИТЬКОНТЕКСТ( "ВременныйДокумент" );

ДОБАВИТЬКОНТЕКСТ( "SELECT * FROM spr" + _DOCCODE + " WHERE identity_column = " + _DOCIC, "ВременныйДокумент" );
ЧИТАТЬЗАПИСЬ( "ВременныйДокумент" );
УДАЛИТЬКОНТЕКСТ( "ВременныйДокумент" );

_ТИПОБЪЕКТА								= "DOC";
objtype									= "DOC";
КОДОБЪЕКТА								= _DOCCODE;
_КОДОБЪЕКТА								= _DOCCODE;
objcode									= _DOCCODE;

ИДОБЪЕКТА								= _DOCIC;
ИДДОКУМЕНТА								= _DOCIC;
ИДКАРТОЧКИ								= _DOCIC;
objid									= _DOCIC;
identity_column							= _DOCIC;
_DOCID									= _DOCIC;

author									= "";
_АВТОР									= "";
link_code 								= "";
link_ic	 								= 0;
link_ndok 								= "";
link_date 								= {};
link_type 								= "";
_ТИПДОКУМЕНТАОСНОВАНИЯ					= "";
_ИДДОКУМЕНТАОСНОВАНИЯ	 				= 0;
_НОМЕРДОКУМЕНТАОСНОВАНИЯ 				= "";
_ДАТАДОКУМЕНТАОСНОВАНИЯ 				= {};
_ТИПСВЯЗИ 								= "";

viewpoint								= _ТОЧКАЗРЕНИЯ;
level_									= 0;
parent									= 0;
_ПАПКА									= 0;
user									= ЗАПРОС( "SELECT SUSER_SNAME( )" );
_ПОЛЬЗОВАТЕЛЬ							= user;
_ГРУППАПОЛЬЗОВАТЕЛЕЙ					= ЗАПРОС( "SELECT group_ FROM username WHERE code= SUSER_SNAME( )" );
usergroup								= _ГРУППАПОЛЬЗОВАТЕЛЕЙ;
newrecord								= ИСТИНА;
_НОВАЯЗАПИСЬ							= ИСТИНА;
_АВТОМАТИЧЕСКОЕСОЗДАНИЕ					= ИСТИНА;
autocreated								= ИСТИНА;
localTableName							= "";
ИМЯТАБЛИЦЫ								= "";
callingPlace							= "";
МЕСТОВЫЗОВА								= "";
_DOCUMENTLOADED							= true;
_ДОКУМЕНТЗАГРУЖЕН						= true;
_АВТОР									= _ПОЛЬЗОВАТЕЛЬ;

_УЧЕТ									= ЗАПРОС( "SELECT dbo.fn_getdefaultaccount( '' )" );
РабочийУчет								= _УЧЕТ;
workAccount								= _УЧЕТ;
account_								= _УЧЕТ;
viewpoint								= _ТОЧКАЗРЕНИЯ;
_РАБОЧАЯБАЗА							= ЗАПРОС( "SELECT DB_NAME( )" );
workDataBase							= _РАБОЧАЯБАЗА;
РабочаяБазаДанных						= _РАБОЧАЯБАЗА;
_WORKDATABASE							= _РАБОЧАЯБАЗА;
_СПИСОКОБЪЕКТОВ							= false;
СПИСОКОБЪЕКТОВ							= false;
objlist									= false;
_ИДКОПИРУЕМОГОДОКУМЕНТА					= 0;
_КОДКОПИРУЕМОГОДОКУМЕНТА				= "";
_COPYDOCID								= 0;
_COPYDOCCODE							= "";
_ДЕСКРИПТОРОКНА							= 0;
HWND									= 0;
_СООБЩЕНИЕУСТАНОВИТЬДОСТУПНОСТЬПОЛЯ		= 0;
_СООБЩЕНИЕУСТАНОВИТЬДОСТУПНОСТЬМЕТКИ	= 0;
_СООБЩЕНИЕУСТАНОВИТЬВИДИМОСТЬПОЛЯ		= 0;
_СООБЩЕНИЕУСТАНОВИТЬВИДИМОСТЬМЕТКИ		= 0;
_СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯ		= 0;
_СООБЩЕНИЕПОЛУЧИТЬЗНАЧЕНИЕПОЛЯ			= 0;
_СООБЩЕНИЕУСТАНОВИТЬЗНАЧЕНИЕПОЛЯВСТРОКЕ	= 0;
_СООБЩЕНИЕПОЛУЧИТЬЗНАЧЕНИЕПОЛЯВСТРОКЕ	= 0;
_СООБЩЕНИЕУСТАНОВИТЬТЕКСТМЕТКИ			= 0;
_СООБЩЕНИЕПОЛУЧИТЬТЕКСТМЕТКИ			= 0;
_СООБЩЕНИЕВЫПОЛНИТЬКОМАНДУ				= 0;
_ГЛАВНОЕОКНОПРИЛОЖЕНИЯ					= 0;
_СООБЩЕНИЕ_ПРОСМОТРДОКУМЕНТА			= 0;
_СООБЩЕНИЕ_ПРОСМОТРСПРАВОЧНИКА			= 0;

//----- Выполняем скрипт
RETURN ВЫЧИСЛИТЬ( ТекстСкрипта );
