PUBLIC ПРИЗНАКОЧИСТКИТСД, ФормироватьЛогНесоответствий, СписокНеНайденных, НеСоответствиеАлкокодов, ВыбиратьДокументыДляЗагрузки;
PUBLIC _ПРОДОЛЖИТЬОБРАБОТКУ, _DODEFAULT, КолВоДок, ТСДНазваниеТовара, ТСДШтрихКод, ТСДКодТовара, СоздаватьТовары, ПутьКЛогуНесоответствий;
PUBLIC _ГЛАВНОЕОКНОПРИЛОЖЕНИЯ, _СООБЩЕНИЕВЫПОЛНИТЬКОМАНДУ, _ERROR, _ОШИБКАВЫПОЛНЕНИЯ, КОДДОКУМЕНТА, ИДВНУТРЕННИЙДОК, ИДДОКУМЕНТА;
PUBLIC ЗагружатьТолькоНенулевыеКоличества, Фирма, Склад, СкладПолучатель, _ИМЯТАБЛИЦЫ, ИскатьТоварыПоКодуПриЗагрузке, АлкоДок, ПРИХОДЗАГРУЖАТЬСУММУИЗЦЕНЫ; 
PUBLIC СписокДокументов, АлкогольТолькоНовыеМарки, АлкогольТолькоСтарыеМарки, _ЕстьПараметрТолькоНовыеМарки, _ЕстьПараметрТолькоСтарыеМарки, ТипДокумента, ТСДИмяВременнойТаблицы;

ФормироватьЛогНесоответствий = ПЕРЕМЕННАЯ("_МАРКСКАН_ФОРМИРОВАТЬЛОГНЕСООТВЕТСТВИЙ", false );
ПутьКЛогуНесоответствий = ПЕРЕМЕННАЯ("_МАРКСКАН_ПУТЬКЛОГУНЕСООТВЕТСТВИЙ", "" ); //каталог для выгрузки лога несоответствий и лога не найденных при сканировании товаров (по умолчанию пустое значение, т.е. будет сохранять в каталог установки Айтида)
ЗагружатьТолькоНенулевыеКоличества = ПЕРЕМЕННАЯ("_МАРКСАН_ЗАГРУЖАТЬСТРОКИСНУЛЕВЫМКОЛИЧЕСТВОМ", false );

_ЕСТЬПАРАМЕТР = ЗАПРОС("SELECT code FROM sprparams WHERE name='МАРКСКАН_ВЫБОРДОКУМЕНТОВ'");
IF (_ЕСТЬПАРАМЕТР==false OR ПУСТО(_ЕСТЬПАРАМЕТР))
{
	СООБЩЕНИЕ("Для работы функции выбора документов в ТСД для загрузки, необходимо загрузить параметр ""МАРКСКАН_ВЫБОРДОКУМЕНТОВ"" в справочник параметров системы."+CHR(13)+CHR(10)+
	"Доступ к справочнику параметров системы возможен только из режима расширенного конфигурирования."+CHR(13)+CHR(10)+
	"Свяжитесь с вашим системным администратором.", RESTAPI.ИМЯОБОРУДОВАНИЯ() );
	ВыбиратьДокументыДляЗагрузки = false;
}
ELSE
	ВыбиратьДокументыДляЗагрузки = true;

СоздаватьТовары = ПЕРЕМЕННАЯ("_МАРКСКАН_СОЗДАВАТЬНОВЫЕТОВАРЫ", false );
ИскатьТоварыПоКодуПриЗагрузке = ПЕРЕМЕННАЯ("_МАРКСКАН_ОПРЕДЕЛЯТЬТОВАРЫПОКОДУ", false );

ФирмаИзОборудования	= ЗАПРОС( "SELECT sklad FROM sprequipment WHERE code= '" + RESTAPI.КОДОБОРУДОВАНИЯ() + "'" ); ;
СкладИзОборудования = ЗАПРОС( "SELECT sklad FROM sprequipment WHERE code= '" + RESTAPI.КОДОБОРУДОВАНИЯ() + "'" );
СкладПоУмолчанию	= ЗАПРОС("SELECT value_ FROM userprop WHERE user_=SUSER_SNAME() AND prop_='sklcode'");
ФирмаПоУмолчанию	= ЗАПРОС("SELECT value_ FROM userprop WHERE user_=SUSER_SNAME() AND prop_='firmcode'");

Фирма				= ПЕРЕМЕННАЯ( "ФирмаИзОборудования", ФирмаПоУмолчанию);
Склад				= ПЕРЕМЕННАЯ( "СкладИзОборудования", СкладПоУмолчанию);
СкладПолучатель		= "";


IF ( TYPE( "ПРИЗНАКОЧИСТКИТСД" ) <> "L"  )
{
	Ответ = MESSAGEBOX( "Удалить загруженные документы с сервера после загрузки данных?", RESTAPI.ИМЯОБОРУДОВАНИЯ(),4);
	IF (Ответ == 6)
		ПРИЗНАКОЧИСТКИТСД = true;
	ELSE	
		ПРИЗНАКОЧИСТКИТСД = false;
}
