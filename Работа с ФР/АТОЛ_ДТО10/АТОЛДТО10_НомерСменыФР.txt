// Номер смены в ФР
//IF ( ПЕРЕМЕННАЯ("НомерСменыККМ", 0) <> 0 )
//	RETURN НомерСменыККМ;

НомерСменыККМ = 0;
IF ( !ФР.АТОЛДТО10_ОткрытьФР( КОДОБОРУДОВАНИЯ, "Номер смены" ) ) RETURN 0;
	
ТекстЗапросаСтатусСмены = "
{
	""type"": ""getShiftStatus""
}
";

fptr.setParam( fptr.LIBFPTR_PARAM_JSON_DATA, ТекстЗапросаСтатусСмены );
fptr.processJson( );

ОтветСтатусСмены	= fptr.getParamString( fptr.LIBFPTR_PARAM_JSON_DATA );
		
СтатусСмены 		= ПОЛЕ_JSON( ПОЛЕ_JSON( ОтветСтатусСмены, "shiftStatus", "" ), "state", "" );
НомерСменыККМ 		= VAL( ПОЛЕ_JSON( ПОЛЕ_JSON( ОтветСтатусСмены, "shiftStatus", "" ), "number", "" ) ); // + ЕСЛИ( СтатусСмены == "closed", 1, 0 );

// Закрываем соединение с ККТ
ФР.АТОЛДТО10_ЗакрытьФРСПроверкойНаОшибки( "номер смены", true );

RETURN НомерСменыККМ;
