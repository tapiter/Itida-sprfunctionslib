ПозицииЧека = "";
НОМЕРКОПИИСЛИПА = 0;
//СООБЩЕНИЕ("Печатаем слип на ФР в количестве " + КОЛИЧЕСТВОСЛИПОВ, ФР.КОДОБОРУДОВАНИЯ() );
WHILE ( НОМЕРКОПИИСЛИПА < КОЛИЧЕСТВОСЛИПОВ )
{
	РазделительСтрок 	= CHR(10);
	НомерСтрокиСлипа	= 1;
	СлипЧекВрем			= РазделительСтрок + СлипЧек;
	СтрокаСлипа			= ПОЛУЧИТЬСЛОВО( СлипЧекВрем, РазделительСтрок, НомерСтрокиСлипа );
	WHILE ( !ПУСТО( СтрокаСлипа ) )
	{
		IF (  МОДЕЛЬОБОРУДОВАНИЯ == "АТОЛДТО10" )
			ФР.АТОЛДТО10_ДобавитьСтрокуЧека( ПозицииЧека, СтрокаСлипа, false, "text", "left", "words", _ШРИФТТЕКСТАДЛЯНЕФИСКАЛЬНОЙПЕЧАТИ);
		ELSE IF (  МОДЕЛЬОБОРУДОВАНИЯ == "ШТРИХ" )
		{
			driverKKM.StringForPrinting	= СтрокаСлипа;
			driverKKM.PrintString( );
		}
			
		НомерСтрокиСлипа++;
		СтрокаСлипа		= ПОЛУЧИТЬСЛОВО( СлипЧекВрем, РазделительСтрок, НомерСтрокиСлипа );
	}				
	
	IF (  МОДЕЛЬОБОРУДОВАНИЯ == "АТОЛДТО10" )
	{
		ЗаголовокЧека = "
		{
			""type"": ""nonFiscal"",";
		
		ТекстЧека = ЗаголовокЧека + "
		""items"": [
		" + ПозицииЧека + "
		]
		}";
		РезультатПечати = ФР.АТОЛДТО10_ФискализироватьЧек( ТекстЧека, false, ФР.КОДОБОРУДОВАНИЯ() );
	}
	ELSE IF (  МОДЕЛЬОБОРУДОВАНИЯ == "ШТРИХ" )
	{
		ФР.ШТРИХ_ОтрезатьЧек();
		РезультатПечати = true;
	}
	
	IF (РезультатПечати == false)
	{
		WHILE (РезультатПечати <> true)
		{
			СообщениеПользователю = "Слип не напечатан в ККМ." + CHR(13) + "Повторить печать слипа?";
			КодОтвета = MESSAGEBOX(СообщениеПользователю,"Ошибка печати слипа",5);
			IF (КодОтвета==4) //если нажали "Повторить"
			{
				IF (  МОДЕЛЬОБОРУДОВАНИЯ == "АТОЛДТО10" )
					РезультатПечати = ФР.АТОЛДТО10_ФискализироватьЧек( ТекстЧека, false, ФР.КОДОБОРУДОВАНИЯ() ); //повторим печать слипа
			}
			ELSE //если нажали "Отмена"
			{
				Вопрос					= "Вы действительно хотите отменить печать слипа?";
				ОтветНаВопрос			= MESSAGEBOX(Вопрос,"Печать слипа",4);
				IF (ОтветНаВопрос == 6)
				{
					РезультатПечати	= false;
					BREAK;
				}
			}
		}
		//RETURN false;
	}
	
	//если успешно напечатали нефискальный чек, то обнуляем текст чека и нефискальные строки
	ТекстЧека = "";
	ЗаголовокЧека = "";
	ПозицииЧека = "";
	
	НОМЕРКОПИИСЛИПА++;
}// конец цикла по количеству слипов
RETURN true;
