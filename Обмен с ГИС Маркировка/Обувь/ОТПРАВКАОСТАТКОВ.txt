//------ Читаем документы из локальной таблицы
ДОБАВИТЬКОНТЕКСТ( "SELECT guid, ic FROM " + ИМЯТАБЛИЦЫ, "СписокДокументов" );
IF ( КОЛИЧЕСТВОСТРОК( "СписокДокументов" ) == 0 )
	СООБЩЕНИЕ( "Не было отмечено ни одного документа в списке." );

ПОКА ( !КОНЕЦКОНТЕКСТА( "СписокДокументов" ) )
{
	Статус	= ЗАПРОС( "SELECT status FROM mark_stock WHERE identity_column = " + СписокДокументов.ic );
	Метод	= ЗАПРОС( "SELECT releasemethod FROM mark_stock WHERE identity_column = " + СписокДокументов.ic );
	
	IF ( UPPER( ALLTRIM( Метод ) ) == "KM_WORK" )
		МАРКИРОВКА.ЗАГРУЗИТЬКМВОБОРОТЕИЗГИСМТ( ПРЕДПРИЯТИЕ, СписокДокументов.ic );	
	ELSE IF ( UPPER( ALLTRIM( Метод ) ) == "KM_WORKALL" )
		МАРКИРОВКА.ЗАГРУЗИТЬВСЕКМВОБОРОТЕИЗГИСМТ( ПРЕДПРИЯТИЕ, СписокДокументов.ic );	
	ELSE IF ( Статус == 0 )
		МАРКИРОВКА.ЗАКАЗКОДОВМАРКИРОВКИ( ПРЕДПРИЯТИЕ, СписокДокументов.ic );
	ELSE IF ( Статус == 1 )
		МАРКИРОВКА.ПОЛУЧЕНИЕКОДОВМАРКИРОВКИ( ПРЕДПРИЯТИЕ, СписокДокументов.ic );
	ELSE IF ( Статус == 2 )
		МАРКИРОВКА.ВВОДВОБОРОТ( ПРЕДПРИЯТИЕ, СписокДокументов.ic );
	ELSE IF ( Статус == 5 )
		МАРКИРОВКА.АГРЕГАЦИЯ( ПРЕДПРИЯТИЕ, СписокДокументов.ic );
	ELSE IF ( !ПУСТО( СписокДокументов.guid ) )
		МАРКИРОВКА.ПРОВЕРКАСТАТУСАДОКУМЕНТА( ПРЕДПРИЯТИЕ, СписокДокументов.guid );
	
	ОЖИДАНИЕ( 500 );
	ПРОПУСТИТЬ( 1, "СписокДокументов" );
}
УДАЛИТЬКОНТЕКСТ( "СписокДокументов" );
