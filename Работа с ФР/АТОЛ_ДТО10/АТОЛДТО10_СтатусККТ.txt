// Печать прочих отчетов
// Получение статуса

// Параметры - 
// КодСтатуса строка, определяющая статус, значение которого необходимо вернуть.

Статус = 0;
IF ( КодСтатуса == "SESSION" OR КодСтатуса == "SESSIONOPENED" )
{	
	IF ( !ФР.АТОЛДТО10_ОткрытьФР( КОДОБОРУДОВАНИЯ, "Статус ККТ" ) ) RETURN false;
		
	ТекстЗапросаСтатусСмены = "
	{
		""type"": ""getShiftStatus""
	}
	";
	
	fptr.setParam( fptr.LIBFPTR_PARAM_JSON_DATA, ТекстЗапросаСтатусСмены );
	fptr.processJson();
	
	ОтветСтатусСмены = fptr.getParamString( fptr.LIBFPTR_PARAM_JSON_DATA );
	ЗАГРУЗИТЬJSON( "ДанныеСтатусСмены", ПОЛЕ_JSON( ОтветСтатусСмены, "shiftStatus", "" ) );
	ВЫБРАТЬКОНТЕКСТ( "ДанныеСтатусСмены" );
	
	СтатусСмены 	= ДанныеСтатусСмены.state;
	НомерСменыККМ	= VAL( ДанныеСтатусСмены.number ) + ЕСЛИ( СтатусСмены == "closed", 1, 0 );
	
	IF ( КодСтатуса == "SESSION" )
		Статус 		= НомерСменыККМ;
	ELSE
	{
		IF ( СтатусСмены == "expired" )
		{
			СООБЩЕНИЕ("ККМ """ + ФР.ИмяОборудования() + """: Смена превысила 24 часа." + CHR(13) + "Необходимо произвести закрытие смены.");
		}
		Статус 		= СтатусСмены <> "closed";
	}
	
	УДАЛИТЬКОНТЕКСТ("ДанныеСтатусСмены");
	
	IF ( !ФР.АТОЛДТО10_ЗакрытьФРСПроверкойНаОшибки( "Статус ККТ", true ) ) RETURN false;
}

RETURN Статус;
