Результат = 0;

IF ( МЕСТОВЫЗОВА == "РАСЧЕТНАЧИСЛЕНИЙ" )
{
	РазмерКэшбэка = RESTAPI.Locards_РазмерКэшбэка( НОМЕРКАРТЫ, "", false );
	
	
	Сервис.РМККоманда( "ВЫБРАТЬ", "РЕГИСТРАЦИЯ" );
	Сервис.РМККоманда( "ПЕРЕЙТИВНАЧАЛО" );
	_КОНЕЦФАЙЛА			= false;
	РазделительСтрок	= CHR(13) + CHR(10);
	СуммаДляРасчетаБонуса = 0.00;
	WHILE ( !_КОНЕЦФАЙЛА )
	{
		Сервис.РМККоманда( "ПОЛУЧИТЬЗНАЧЕНИЕПОЛЯВСТРОКЕ", "nn");
		Сервис.РМККоманда( "ПОЛУЧИТЬЗНАЧЕНИЕПОЛЯВСТРОКЕ", "cena");
		Сервис.РМККоманда( "ПОЛУЧИТЬЗНАЧЕНИЕПОЛЯВСТРОКЕ", "kolp");
		Сервис.РМККоманда( "ПОЛУЧИТЬЗНАЧЕНИЕПОЛЯВСТРОКЕ", "summa_wd");
		Сервис.РМККоманда( "ПОЛУЧИТЬЗНАЧЕНИЕПОЛЯВСТРОКЕ", "name");
		
		ЭтоОбязательныйАссортимент = ЗАПРОС( "SELECT f_nessassortment FROM sprres WHERE code = '" + nn + "'" );
		
		IF ( !ЭтоОбязательныйАссортимент )
			СуммаДляРасчетаБонуса += summa_wd;		
			 
		Сервис.РМККоманда( "ПРОПУСТИТЬ" );
	}	
	
	Результат = ROUND( СуммаДляРасчетаБонуса * РазмерКэшбэка / 100, 2 );	
}
ELSE IF ( МЕСТОВЫЗОВА == "РАСЧЕТСКИДКИ" )
	Результат = 0;
ELSE IF ( МЕСТОВЫЗОВА == "ОТМЕНАЧЕКА" )	
	RESTAPI.LOCARDS_УдалениеПокупки( ИДЧЕКА, _ИДЧЕКАОСНОВАНИЯ, НОМЕРКАРТЫ, false );
	
RETURN Результат;
